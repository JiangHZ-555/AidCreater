# AidCreater 项目共识文档 (CONSENSUS)

## 1. 明确的需求描述

### 1.1 产品定位
AidCreater是一个基于节点工作流的创意生成工具，专为产品设计师提供AI驱动的创意发散服务。通过可视化的节点连接方式，用户可以构建创意生成流程，利用智谱GLM-4.5模型生成高质量的设计创意。

### 1.2 核心功能规格

**节点系统**
- **输入节点**: 支持文本输入，用于定义品类、需求等初始信息
- **Agent节点**: 集成智谱API，根据输入生成创意内容
- **输出节点**: 展示生成结果，支持文本编辑和格式化

**工作流引擎**
- 支持节点拖拽和自由布局
- 通过连接线定义数据流向
- 单击运行按钮执行整个工作流
- 实时显示执行状态和进度

**用户界面**
- 左侧画布区域：节点操作和工作流设计
- 右侧面板：选中节点的详细信息和编辑功能
- 顶部工具栏：节点库、运行控制、保存等功能

## 2. 技术实现方案

### 2.1 技术栈选择

**前端技术栈**
- **框架**: React 18 + TypeScript
- **拖拽库**: React Flow (专业的节点编辑器)
- **UI组件**: Ant Design
- **状态管理**: Zustand (轻量级状态管理)
- **构建工具**: Vite

**后端技术栈**
- **运行时**: Node.js + Express
- **API集成**: 智谱AI官方SDK
- **数据存储**: 本地JSON文件 + SQLite
- **文件管理**: 本地文件系统

### 2.2 智谱API集成方案

**API配置管理**
```javascript
// 环境变量配置
ZHIPU_API_KEY=your_api_key_here
ZHIPU_BASE_URL=https://open.bigmodel.cn/api/paas/v4/
```

**调用封装**
- 创建统一的API调用服务
- 实现请求重试和错误处理
- 支持流式响应和实时更新
- 添加调用频率限制和缓存机制

### 2.3 数据模型设计

**节点数据结构**
```typescript
interface Node {
  id: string;
  type: 'input' | 'agent' | 'output';
  position: { x: number; y: number };
  data: {
    label: string;
    content?: string;
    config?: Record<string, any>;
  };
}
```

**工作流数据结构**
```typescript
interface Workflow {
  id: string;
  name: string;
  nodes: Node[];
  edges: Edge[];
  createdAt: Date;
  updatedAt: Date;
}
```

**资产数据结构**
```typescript
interface Asset {
  id: string;
  title: string;
  content: string;
  type: 'idea' | 'concept' | 'design';
  tags: string[];
  workflowId: string;
  createdAt: Date;
}
```

## 3. 技术约束和集成方案

### 3.1 部署约束
- **本地部署**: 使用Electron打包为桌面应用
- **一键启动**: 提供安装包和启动脚本
- **跨平台**: 支持Windows、macOS、Linux
- **无需额外依赖**: 内置所有必要组件

### 3.2 性能约束
- **响应时间**: 界面操作响应时间 < 100ms
- **API调用**: 智谱API调用超时时间 30s
- **并发限制**: 同时最多3个API请求
- **内存使用**: 应用内存占用 < 500MB

### 3.3 安全约束
- **API密钥**: 本地加密存储，不上传到服务器
- **数据隐私**: 所有数据本地存储，不外传
- **网络安全**: 仅与智谱API通信，使用HTTPS

## 4. 任务边界和限制

### 4.1 MVP功能边界

**包含功能**
- ✅ 基础的三种节点类型（输入、Agent、输出）
- ✅ 简单的线性工作流（不支持分支和循环）
- ✅ 智谱GLM-4.5模型集成
- ✅ 本地资产保存和管理
- ✅ 基础的文本编辑功能
- ✅ 工作流的保存和加载

**不包含功能**
- ❌ 复杂的条件分支和循环逻辑
- ❌ 多用户协作和权限管理
- ❌ 云端同步和备份
- ❌ 高级的富文本编辑器
- ❌ 插件系统和扩展机制
- ❌ 移动端适配

### 4.2 技术限制
- 单个工作流最多支持20个节点
- 单次API调用最大输入长度4000字符
- 本地存储最大容量1GB
- 同时打开的工作流数量限制为5个

## 5. 验收标准

### 5.1 功能验收标准

**节点操作**
- [ ] 用户可以从节点库拖拽节点到画布
- [ ] 节点可以在画布中自由移动
- [ ] 节点可以通过连接线连接
- [ ] 节点可以删除和复制

**工作流执行**
- [ ] 点击运行按钮可以执行工作流
- [ ] 执行过程中显示实时状态
- [ ] 执行完成后显示结果
- [ ] 执行失败时显示错误信息

**智谱API集成**
- [ ] 成功调用智谱GLM-4.5 API
- [ ] 正确处理API响应和错误
- [ ] 支持流式响应显示
- [ ] API密钥安全存储

**资产管理**
- [ ] 可以保存生成的创意为资产
- [ ] 可以查看和管理已保存的资产
- [ ] 可以从资产创建新的节点
- [ ] 支持资产的导出功能

### 5.2 性能验收标准
- [ ] 应用启动时间 < 5秒
- [ ] 节点拖拽操作流畅，无明显延迟
- [ ] API调用响应时间 < 30秒
- [ ] 界面操作响应时间 < 100ms

### 5.3 兼容性验收标准
- [ ] 在Windows 10+系统正常运行
- [ ] 在macOS 10.15+系统正常运行
- [ ] 在主流Linux发行版正常运行
- [ ] 支持1920x1080及以上分辨率

## 6. 开发里程碑

### 6.1 第一阶段：基础框架 (Week 1-2)
- 项目初始化和环境搭建
- React Flow集成和基础画布
- 基础节点组件开发
- 智谱API集成测试

### 6.2 第二阶段：核心功能 (Week 3-4)
- 工作流执行引擎
- 节点间数据传递
- 右侧编辑面板
- 本地数据存储

### 6.3 第三阶段：完善和优化 (Week 5-6)
- 资产管理功能
- 错误处理和用户体验优化
- 性能优化和测试
- 打包和部署方案

## 7. 风险评估和缓解策略

### 7.1 技术风险
**风险**: 智谱API调用不稳定
**缓解**: 实现重试机制和降级方案

**风险**: React Flow学习曲线陡峭
**缓解**: 提前进行技术预研和原型验证

**风险**: Electron打包体积过大
**缓解**: 使用代码分割和资源优化

### 7.2 产品风险
**风险**: 用户学习成本过高
**缓解**: 提供详细的使用指南和示例模板

**风险**: 生成内容质量不稳定
**缓解**: 优化提示词模板和参数调优

---

**文档状态**: 已确认  
**创建时间**: 2024年  
**确认人**: AI架构师  
**版本**: v1.0